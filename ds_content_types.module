<?php

use Drupal\taxonomy\Entity\Term;
use \Drupal\field\Entity\FieldStorageConfig;
use \Drupal\Core\Entity\ContentEntityInterface;

/**
 * @file
 * Provides main functionality for ds_content_types module.
 */

/**
 * Creates the default terms in a vocabulary.
 *
 * @param string $vocabulary
 *   The vocabulary id.
 * @param array $terms
 *   The terms to create.
 * @param array $parent
 *   The term parents.
 * @param string $code_field_name
 *   The code field to populate.
 */
function _ds_content_types_add_terms($vocabulary, $terms, array $parent, $code_field_name) {
  foreach ($terms as $key => $term_data) {
    $term = Term::create([
      'name' => $term_data[0],
      'vid' => $vocabulary,
      'parent' => $parent,
      $code_field_name => $term_data[1],
    ]);
    $term->save();
    if (isset($term_data['children'])) {
      _ds_content_types_add_terms($vocabulary, $term_data['children'], [$term->id()], $code_field_name);
    }
  }
}

/**
 * Process the terms array generated from CSV.
 *
 * @param array $terms
 *   The terms array to process.
 */
function _ds_content_types_process_terms(array &$terms) {
  foreach ($terms as $key => $data) {
    if (!empty($data[2])) {
      $names = array_combine(array_keys($terms), array_column($terms, 0));
      $parent_key = array_search($data[2], $names);
      if ($parent_key !== FALSE) {
        $terms[$parent_key]['children'][] = $data;
        unset($terms[$key]);
      }
    }
  }
}

/**
 * Set dynamic allowed values for the Industry field.
 *
 * @param \Drupal\field\Entity\FieldStorageConfig $definition
 *   The field definition.
 * @param \Drupal\Core\Entity\ContentEntityInterface|null $entity
 *   The entity being created if applicable.
 * @param bool $cacheable
 *   Boolean indicating if the results are cacheable.
 *
 * @return array
 *   An array of possible key and value options.
 *
 * @see options_allowed_values()
 */
function ds_content_types_industry_allowed_values_function(FieldStorageConfig $definition, ContentEntityInterface $entity = NULL, $cacheable) {
  $options = [
    (string) t('Generic programmes and qualifications not further defined') => [
      'http://data.europa.eu/snb/isced-f/0000' => t('Generic programmes and qualifications not further defined'),
    ],
    (string) t('Basic programmes and qualifications') => [
      'http://data.europa.eu/snb/isced-f/0011' => t('Basic programmes and qualifications'),
    ],
    (string) t('Literacy and numeracy') => [
      'http://data.europa.eu/snb/isced-f/0021' => t('Literacy and numeracy'),
    ],
    (string) t('Personal skills and development') => [
      'http://data.europa.eu/snb/isced-f/0031' => t('Personal skills and development'),
    ],
    (string) t('Generic programmes and qualifications not elsewhere classified') => [
      'http://data.europa.eu/snb/isced-f/0099' => t('Generic programmes and qualifications not elsewhere classified'),
    ],
    (string) t('Education') => [
      'http://data.europa.eu/snb/isced-f/0110' => t('Education not further defined'),
      'http://data.europa.eu/snb/isced-f/0111' => t('Education science'),
      'http://data.europa.eu/snb/isced-f/0112' => t('Training for pre-school teachers'),
      'http://data.europa.eu/snb/isced-f/0113' => t('Teacher training without subject specialisation'),
      'http://data.europa.eu/snb/isced-f/0114' => t('Teacher training with subject specialisation'),
      'http://data.europa.eu/snb/isced-f/0119' => t('Education not elsewhere classified'),
    ],
    (string) t('Inter-disciplinary programmes and qualifications involving education') => [
      'http://data.europa.eu/snb/isced-f/0188' => t('Inter-disciplinary programmes and qualifications involving education'),
    ],
    (string) t('Arts and humanities not further defined') => [
      'http://data.europa.eu/snb/isced-f/0200' => t('Arts and humanities not further defined'),
    ],
    (string) t('Arts') => [
      'http://data.europa.eu/snb/isced-f/0210' => t('Arts not further defined'),
      'http://data.europa.eu/snb/isced-f/0211' => t('Audio-visual techniques and media production'),
      'http://data.europa.eu/snb/isced-f/0212' => t('Fashion, interior and industrial design'),
      'http://data.europa.eu/snb/isced-f/0213' => t('Fine arts'),
      'http://data.europa.eu/snb/isced-f/0214' => t('Handicrafts'),
      'http://data.europa.eu/snb/isced-f/0215' => t('Music and performing arts'),
      'http://data.europa.eu/snb/isced-f/0219' => t('Arts not elsewhere classified'),
    ],
    (string) t('Humanities (except languages)') => [
      'http://data.europa.eu/snb/isced-f/0220' => t('Humanities (except languages) not further defined'),
      'http://data.europa.eu/snb/isced-f/0221' => t('Religion and theology'),
      'http://data.europa.eu/snb/isced-f/0222' => t('History and archaeology'),
      'http://data.europa.eu/snb/isced-f/0223' => t('Philosophy and ethics'),
      'http://data.europa.eu/snb/isced-f/0228' => t('Inter-disciplinary programmes and qualifications involving humanities'),
      'http://data.europa.eu/snb/isced-f/0229' => t('Humanities (except languages) not elsewhere classified'),
    ],
    (string) t('Languages') => [
      'http://data.europa.eu/snb/isced-f/0230' => t('Languages not further defined'),
      'http://data.europa.eu/snb/isced-f/0231' => t('Language acquisition'),
      'http://data.europa.eu/snb/isced-f/0232' => t('Literature and linguistics'),
      'http://data.europa.eu/snb/isced-f/0239' => t('Languages not elsewhere classified'),
    ],
    (string) t('Inter-disciplinary programmes and qualifications involving arts and humanities') => [
      'http://data.europa.eu/snb/isced-f/0288' => t('Inter-disciplinary programmes and qualifications involving arts and humanities'),
    ],
    (string) t('Arts and humanities not elsewhere classified') => [
      'http://data.europa.eu/snb/isced-f/0299' => t('Arts and humanities not elsewhere classified'),
    ],
    (string) t('Social sciences, journalism and information not further defined') => [
      'http://data.europa.eu/snb/isced-f/0300' => t('Social sciences, journalism and information not further defined'),
    ],
    (string) t('Social and behavioural sciences') => [
      'http://data.europa.eu/snb/isced-f/0310' => t('Social and behavioural sciences not further defined'),
      'http://data.europa.eu/snb/isced-f/0311' => t('Economics'),
      'http://data.europa.eu/snb/isced-f/0312' => t('Political sciences and civics'),
      'http://data.europa.eu/snb/isced-f/0313' => t('Psychology'),
      'http://data.europa.eu/snb/isced-f/0314' => t('Sociology and cultural studies'),
      'http://data.europa.eu/snb/isced-f/0319' => t('Social and behavioural sciences not elsewhere classified'),
    ],
    (string) t('Journalism and information') => [
      'http://data.europa.eu/snb/isced-f/0320' => t('Journalism and information not further defined'),
      'http://data.europa.eu/snb/isced-f/0321' => t('Journalism and reporting'),
      'http://data.europa.eu/snb/isced-f/0322' => t('Library, information and archival studies'),
      'http://data.europa.eu/snb/isced-f/0329' => t('Journalism and information not elsewhere classified'),
    ],
    (string) t('Inter-disciplinary programmes and qualifications involving social sciences, journalism and information') => [
      'http://data.europa.eu/snb/isced-f/0388' => t('Inter-disciplinary programmes and qualifications involving social sciences, journalism and information'),
    ],
    (string) t('Social sciences, journalism and information not elsewhere classified') => [
      'http://data.europa.eu/snb/isced-f/0399' => t('Social sciences, journalism and information not elsewhere classified'),
    ],
    (string) t('Business, administration and law not further defined') => [
      'http://data.europa.eu/snb/isced-f/0400' => t('Business, administration and law not further defined'),
    ],
    (string) t('Business and administration') => [
      'http://data.europa.eu/snb/isced-f/0410' => t('Business and administration not further defined'),
      'http://data.europa.eu/snb/isced-f/0411' => t('Accounting and taxation'),
      'http://data.europa.eu/snb/isced-f/0412' => t('Finance, banking and insurance'),
      'http://data.europa.eu/snb/isced-f/0413' => t('Management and administration'),
      'http://data.europa.eu/snb/isced-f/0414' => t('Marketing and advertising'),
      'http://data.europa.eu/snb/isced-f/0415' => t('Secretarial and office work'),
      'http://data.europa.eu/snb/isced-f/0416' => t('Wholesale and retail sales'),
      'http://data.europa.eu/snb/isced-f/0417' => t('Work skills'),
      'http://data.europa.eu/snb/isced-f/0419' => t('Business and administration not elsewhere classified'),
    ],
    (string) t('Law') => [
      'http://data.europa.eu/snb/isced-f/0421' => t('Law'),
    ],
    (string) t('Inter-disciplinary programmes and qualifications involving business, administration and law') => [
      'http://data.europa.eu/snb/isced-f/0488' => t('Inter-disciplinary programmes and qualifications involving business, administration and law'),
    ],
    (string) t('Business, administration and law not elsewhere classified') => [
      'http://data.europa.eu/snb/isced-f/0499' => t('Business, administration and law not elsewhere classified'),
    ],
    (string) t('Natural sciences, mathematics and statistics not further defined') => [
      'http://data.europa.eu/snb/isced-f/0500' => t('Natural sciences, mathematics and statistics not further defined'),
    ],
    (string) t('Biological and related sciences') => [
      'http://data.europa.eu/snb/isced-f/0510' => t('Biological and related sciences not further defined'),
      'http://data.europa.eu/snb/isced-f/0511' => t('Biology'),
      'http://data.europa.eu/snb/isced-f/0512' => t('Biochemistry'),
      'http://data.europa.eu/snb/isced-f/0519' => t('Biological and related sciences not elsewhere classified'),
    ],
    (string) t('Environment') => [
      'http://data.europa.eu/snb/isced-f/0520' => t('Environment not further defined'),
      'http://data.europa.eu/snb/isced-f/0521' => t('Environmental sciences'),
      'http://data.europa.eu/snb/isced-f/0522' => t('Natural environments and wildlife'),
      'http://data.europa.eu/snb/isced-f/0529' => t('Environment not elsewhere classified'),
    ],
    (string) t('Physical sciences') => [
      'http://data.europa.eu/snb/isced-f/0530' => t('Physical sciences not further defined'),
      'http://data.europa.eu/snb/isced-f/0531' => t('Chemistry'),
      'http://data.europa.eu/snb/isced-f/0532' => t('Earth sciences'),
      'http://data.europa.eu/snb/isced-f/0533' => t('Physics'),
      'http://data.europa.eu/snb/isced-f/0539' => t('Physical sciences not elsewhere classified'),
    ],
    (string) t('Mathematics and statistics') => [
      'http://data.europa.eu/snb/isced-f/0540' => t('Mathematics and statistics not further defined'),
      'http://data.europa.eu/snb/isced-f/0541' => t('Mathematics'),
      'http://data.europa.eu/snb/isced-f/0542' => t('Statistics'),
    ],
    (string) t('Inter-disciplinary programmes and qualifications involving natural sciences, mathematics and statistics') => [
      'http://data.europa.eu/snb/isced-f/0588' => t('Inter-disciplinary programmes and qualifications involving natural sciences, mathematics and statistics'),
    ],
    (string) t('Natural sciences, mathematics and statistics not elsewhere classified') => [
      'http://data.europa.eu/snb/isced-f/0599' => t('Natural sciences, mathematics and statistics not elsewhere classified'),
    ],
    (string) t('Information and Communication Technologies (ICTs)') => [
      'http://data.europa.eu/snb/isced-f/0610' => t('Information and Communication Technologies (ICTs) not further defined'),
      'http://data.europa.eu/snb/isced-f/0611' => t('Computer use'),
      'http://data.europa.eu/snb/isced-f/0612' => t('Database and network design and administration'),
      'http://data.europa.eu/snb/isced-f/0613' => t('Software and applications development and analysis'),
      'http://data.europa.eu/snb/isced-f/0619' => t('Information and communication technologies not elsewhere classified'),
    ],
    (string) t('Inter-disciplinary programmes and qualifications involving Information and Communication Technologies (ICTs)') => [
      'http://data.europa.eu/snb/isced-f/0688' => t('Inter-disciplinary programmes and qualifications involving Information and Communication Technologies (ICTs)'),
    ],
    (string) t('Engineering, manufacturing and construction not further defined') => [
      'http://data.europa.eu/snb/isced-f/0700' => t('Engineering, manufacturing and construction not further defined'),
    ],
    (string) t('Engineering and engineering trades') => [
      'http://data.europa.eu/snb/isced-f/0710' => t('Engineering and engineering trades not further defined'),
      'http://data.europa.eu/snb/isced-f/0711' => t('Chemical engineering and processes'),
      'http://data.europa.eu/snb/isced-f/0712' => t('Environmental protection technology'),
      'http://data.europa.eu/snb/isced-f/0713' => t('Electricity and energy'),
      'http://data.europa.eu/snb/isced-f/0714' => t('Electronics and automation'),
      'http://data.europa.eu/snb/isced-f/0715' => t('Mechanics and metal trades'),
      'http://data.europa.eu/snb/isced-f/0716' => t('Motor vehicles, ships and aircraft'),
      'http://data.europa.eu/snb/isced-f/0719' => t('Engineering and engineering trades not elsewhere classified'),
    ],
    (string) t('Manufacturing and processing') => [
      'http://data.europa.eu/snb/isced-f/0720' => t('Manufacturing and processing not further defined'),
      'http://data.europa.eu/snb/isced-f/0721' => t('Food processing'),
      'http://data.europa.eu/snb/isced-f/0722' => t('Materials (glass, paper, plastic and wood)'),
      'http://data.europa.eu/snb/isced-f/0723' => t('Textiles (clothes, footwear and leather)'),
      'http://data.europa.eu/snb/isced-f/0724' => t('Mining and extraction'),
      'http://data.europa.eu/snb/isced-f/0729' => t('Manufacturing and processing not elsewhere classified'),
    ],
    (string) t('Architecture and construction') => [
      'http://data.europa.eu/snb/isced-f/0730' => t('Architecture and construction not further defined'),
      'http://data.europa.eu/snb/isced-f/0731' => t('Architecture and town planning'),
      'http://data.europa.eu/snb/isced-f/0732' => t('Building and civil engineering'),
    ],
    (string) t('Inter-disciplinary programmes and qualifications involving engineering, manufacturing and construction') => [
      'http://data.europa.eu/snb/isced-f/0788' => t('Inter-disciplinary programmes and qualifications involving engineering, manufacturing and construction'),
    ],
    (string) t('Engineering, manufacturing and construction not elsewhere classified') => [
      'http://data.europa.eu/snb/isced-f/0799' => t('Engineering, manufacturing and construction not elsewhere classified'),
    ],
    (string) t('Agriculture, forestry, fisheries and veterinary not further defined') => [
      'http://data.europa.eu/snb/isced-f/0800' => t('Agriculture, forestry, fisheries and veterinary not further defined'),
    ],
    (string) t('Agriculture') => [
      'http://data.europa.eu/snb/isced-f/0810' => t('Agriculture not further defined'),
      'http://data.europa.eu/snb/isced-f/0811' => t('Crop and livestock production'),
      'http://data.europa.eu/snb/isced-f/0812' => t('Horticulture'),
      'http://data.europa.eu/snb/isced-f/0819' => t('Agriculture not elsewhere classified'),
    ],
    (string) t('Forestry') => [
      'http://data.europa.eu/snb/isced-f/0821' => t('Forestry'),
    ],
    (string) t('Fisheries') => [
      'http://data.europa.eu/snb/isced-f/0831' => t('Fisheries'),
    ],
    (string) t('Veterinary') => [
      'http://data.europa.eu/snb/isced-f/0841' => t('Veterinary'),
    ],
    (string) t('Inter-disciplinary programmes and qualifications involving agriculture, forestry, fisheries and veterinary') => [
      'http://data.europa.eu/snb/isced-f/0888' => t('Inter-disciplinary programmes and qualifications involving agriculture, forestry, fisheries and veterinary'),
    ],
    (string) t('Agriculture, forestry, fisheries and veterinary not elsewhere classified') => [
      'http://data.europa.eu/snb/isced-f/0899' => t('Agriculture, forestry, fisheries and veterinary not elsewhere classified'),
    ],
    (string) t('Health and welfare not further defined') => [
      'http://data.europa.eu/snb/isced-f/0900' => t('Health and welfare not further defined'),
    ],
    (string) t('Health') => [
      'http://data.europa.eu/snb/isced-f/0910' => t('Health not further defined'),
      'http://data.europa.eu/snb/isced-f/0911' => t('Dental studies'),
      'http://data.europa.eu/snb/isced-f/0912' => t('Medicine'),
      'http://data.europa.eu/snb/isced-f/0913' => t('Nursing and midwifery'),
      'http://data.europa.eu/snb/isced-f/0914' => t('Medical diagnostic and treatment technology'),
      'http://data.europa.eu/snb/isced-f/0915' => t('Therapy and rehabilitation'),
      'http://data.europa.eu/snb/isced-f/0916' => t('Pharmacy'),
      'http://data.europa.eu/snb/isced-f/0917' => t('Traditional and complementary medicine and therapy'),
      'http://data.europa.eu/snb/isced-f/0919' => t('Health not elsewhere classified'),
    ],
    (string) t('Welfare') => [
      'http://data.europa.eu/snb/isced-f/0920' => t('Welfare not further defined'),
      'http://data.europa.eu/snb/isced-f/0921' => t('Care of the elderly and of disabled adults'),
      'http://data.europa.eu/snb/isced-f/0922' => t('Child care and youth services'),
      'http://data.europa.eu/snb/isced-f/0923' => t('Social work and counselling'),
      'http://data.europa.eu/snb/isced-f/0929' => t('Welfare not elsewhere classified'),
    ],
    (string) t('Inter-disciplinary programmes and qualifications involving health and welfare') => [
      'http://data.europa.eu/snb/isced-f/0988' => t('Inter-disciplinary programmes and qualifications involving health and welfare'),
    ],
    (string) t('Health and welfare not elsewhere classified') => [
      'http://data.europa.eu/snb/isced-f/0999' => t('Health and welfare not elsewhere classified'),
    ],
    (string) t('Services not further defined') => [
      'http://data.europa.eu/snb/isced-f/1000' => t('Services not further defined'),
    ],
    (string) t('Personal services') => [
      'http://data.europa.eu/snb/isced-f/1010' => t('Personal services not further defined'),
      'http://data.europa.eu/snb/isced-f/1011' => t('Domestic services'),
      'http://data.europa.eu/snb/isced-f/1012' => t('Hair and beauty services'),
      'http://data.europa.eu/snb/isced-f/1013' => t('Hotel, restaurants and catering'),
      'http://data.europa.eu/snb/isced-f/1014' => t('Sports'),
      'http://data.europa.eu/snb/isced-f/1015' => t('Travel, tourism and leisure'),
      'http://data.europa.eu/snb/isced-f/1019' => t('Personal services not elsewhere classified'),
    ],
    (string) t('Hygiene and occupational health services') => [
      'http://data.europa.eu/snb/isced-f/1020' => t('Hygiene and occupational health services not further defined'),
      'http://data.europa.eu/snb/isced-f/1021' => t('Community sanitation'),
      'http://data.europa.eu/snb/isced-f/1022' => t('Occupational health and safety'),
      'http://data.europa.eu/snb/isced-f/1029' => t('Hygiene and occupational health services not elsewhere classified'),
    ],
    (string) t('Security services') => [
      'http://data.europa.eu/snb/isced-f/1030' => t('Security services not further defined'),
      'http://data.europa.eu/snb/isced-f/1031' => t('Military and defence'),
      'http://data.europa.eu/snb/isced-f/1032' => t('Protection of persons and property'),
      'http://data.europa.eu/snb/isced-f/1039' => t('Security services not elsewhere classified'),
    ],
    (string) t('Transport services') => [
      'http://data.europa.eu/snb/isced-f/1041' => t('Transport services'),
    ],
    (string) t('Inter-disciplinary programmes and qualifications involving services') => [
      'http://data.europa.eu/snb/isced-f/1088' => t('Inter-disciplinary programmes and qualifications involving services'),
    ],
    (string) t('Services not elsewhere classified') => [
      'http://data.europa.eu/snb/isced-f/1099' => t('Services not elsewhere classified'),
    ],
    (string) t('Field unknown') => [
      'http://data.europa.eu/snb/isced-f/9999' => t('Field unknown'),
    ],
  ];
  return $options;
}
